---
title: "[KOCW] ìš´ì˜ì²´ì œ - ë°˜íš¨ê²½, Process ë™ê¸°í™”"
toc: true
toc_sticky: true
categories:
    - ğŸ“‚ all
    - kunbon
    - ìš´ì˜ì²´ì œ
tags:
    - ìš´ì˜ì²´ì œ
    - study
last_modified_at: 2022-03-05
---

# Process Synchronization

## Race Condition

```
          ------>        <------
Execution          Data          Execution
          <------        ------>
```
ì˜ˆ) í•˜ë‚˜ì˜ ì—°ì‚°ì€ count--, ë‹¤ë¥¸ í•˜ë‚˜ì˜ ì—°ì‚°ì€ count++ì¼ ë•Œ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ê°ì ì—°ì‚°ì„ í•˜ê³  ë°ì´í„°ì— ê²°ê³¼ë¥¼ ì ìš©í•˜ë©´ ë§¨ ë§ˆì§€ë§‰ì— ì—°ì‚°ëœ ê²°ê³¼ë§Œ ë°˜ì˜ëœë‹¤.

- í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ì£¼ì²´ê°€ ë™ì‹œì— ì ‘ê·¼í•˜ë ¤ê³  í•˜ëŠ” ê²ƒì„ Race Condition(ê²½ìŸ ìƒíƒœ)ì´ë¼ í•¨.
- ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë“¤, ì»¤ë„ ë‚´ë¶€ ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ë£¨í‹´ë“¤ ê°„ì— ì´ëŸ¬í•œ ê°„ì„­ì´ ìƒê¸¸ ìˆ˜ ìˆìŒ.

### ë°œìƒí•˜ëŠ” ìƒí™©ê³¼ í•´ê²°ë°©ë²•

1. ì»¤ë„ ìˆ˜í–‰ ì¤‘ ì¸í„°ëŸ½íŠ¸ ë°œìƒì‹œ
	- í•´ê²°ë°©ë²•: ì»¤ë„ ìˆ˜í–‰ ì¤‘ì—” ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šê²Œ í•œë‹¤. ì»¤ë„ ìˆ˜í–‰ì´ ëë‚˜ë©´ ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬.
2. í”„ë¡œì„¸ìŠ¤ê°€ ì‹œìŠ¤í…œ ì½œì„ í•´ ì»¤ë„ ëª¨ë“œë¡œ ìˆ˜í–‰ì¤‘ì¸ ë„ì¤‘ì— context switchê°€ ì¼ì–´ë‚  ë•Œ
	- í•´ê²°ë°©ë²•: ì»¤ë„ ëª¨ë“œì—ì„œ ìˆ˜í–‰ì¤‘ì¼ ë• CPUë¥¼ ì„ ì í•˜ì§€ ì•Šê²Œ í•œë‹¤. ì»¤ë„ ëª¨ë“œì—ì„œ ì‚¬ìš©ì ëª¨ë“œë¡œ ë‹¤ì‹œ ëŒì•„ê°ˆ ë•Œ ì„ ì .
3. ë©€í‹°í”„ë¡œì„¸ì„œì—ì„œ ê³µìœ  ë©”ëª¨ë¦¬ ë‚´ì˜ ì»¤ë„ ë°ì´í„°
	- í•˜ë‚˜ì˜ í”„ë¡œì„¸ì„œê°€ ë°ì´í„°ì— ì ‘ê·¼í•  ë•Œ ë°ì´í„°ì— ëŒ€í•œ lock/unlockì„ ê±¸ì–´ì•¼ í•œë‹¤.
	- í•œ ë²ˆì— ì»¤ë„ì— í•˜ë‚˜ì˜ í”„ë¡œì„¸ì„œë§Œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ í•œë‹¤. (ë¹„íš¨ìœ¨ì ì¸ ë°©ì‹)

## Process Synchronization ë¬¸ì œ

- ê³µìœ  ë°ì´í„°ì˜ ë™ì‹œ ì ‘ê·¼ì€ ë°ì´í„°ì˜ ë¶ˆì¼ì¹˜ ë¬¸ì œë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.
- ì¼ê´€ì„± ìœ ì§€ë¥¼ ìœ„í•´ í˜‘ë ¥ í”„ë¡œì„¸ìŠ¤ ê°„ì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ì •í•´ì£¼ëŠ” ë§¤ì»¤ë‹ˆì¦˜ í•„ìš”í•˜ë‹¤.

* Race condition
- ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ë™ì‹œì— ê³µìœ  ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ìƒí™©
- ë°ì´í„°ì˜ ìµœì¢… ì—°ì‚° ê²°ê³¼ëŠ” ë§ˆì§€ë§‰ì— ê·¸ ë°ì´í„°ë¥¼ ë‹¤ë£¬ í”„ë¡œì„¸ìŠ¤ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤

=> Race conditionì„ ë§‰ê¸° ìœ„í•´ ë™ì‹œ ì ‘ê·¼ì€ ë™ê¸°í™”ê°€ ì˜ ë˜ì–´ì•¼ í•œë‹¤.

## Critical-Section Problem

- í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ê°€ critical-sectionì— ë“¤ì–´ê°”ì„ ë•Œ ë‹¤ë¥¸ ëª¨ë“  í”„ë¡œì„¸ìŠ¤ëŠ” í•´ë‹¹ ì„¹ì…˜ì— ë“¤ì–´ê°ˆ ìˆ˜ ì—†ì–´ì•¼ í•œë‹¤.
- critical-sectionì— ë³µìˆ˜ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë“¤ì–´ê°€ ì„œë¡œ ë‹¤ë¥¸ ì—°ì‚°ì„ í•˜ê²Œ ë˜ë©´, race condition ë°œìƒí•˜ê¸° ë•Œë¬¸.

### Critical-section
- ê³µìœ ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ì½”ë“œ.
- ì•ì˜ ì˜ˆì‹œì—ì„œ, a = a + 1, a = a - 1ê³¼ ê°™ì€ ê³µìœ ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ì½”ë“œ.

## í”„ë¡œê·¸ë¨ì  í•´ê²°ë²•ì˜ ì¶©ì¡±ì¡°ê±´

#### Mutual Exclusion(ìƒí˜¸ ë°°ì œ)
- í”„ë¡œì„¸ìŠ¤ í•˜ë‚˜ê°€ critical section ë¶€ë¶„ì„ ìˆ˜í–‰ì¤‘ì¼ ë•Œ ë‹¤ë¥¸ ëª¨ë“  í”„ë¡œì„¸ìŠ¤ê°€ ë“¤ì–´ê°€ë©´ ì•ˆ ë¨.

#### Progress
- ì•„ë¬´ë„ critical sectionì— ìˆì§€ ì•Šì€ ìƒíƒœì—ì„œ ê·¸ ì„¹ì…˜ì— ë“¤ì–´ê°€ê³ ì í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ìˆìœ¼ë©´ ë“¤ì–´ê°€ê²Œ í•´ ì£¼ì–´ì•¼ í•¨.

#### Bounded Waiting
- í”„ë¡œì„¸ìŠ¤ê°€ critical sectionì— ë“¤ì–´ê°€ë ¤ê³  ìš”ì²­í•œ í›„ë¶€í„° ê·¸ ìš”ì²­ì´ í—ˆìš©ë  ë•Œê¹Œì§€ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë“¤ì´ critical sectionì— ë“¤ì–´ê°€ëŠ” íšŸìˆ˜ì— í•œê³„ê°€ ìˆì–´ì•¼ í•¨.
- ì¦‰, ê¸°ì•„í˜„ìƒì„ ë§‰ì•„ì•¼ í•¨.

### í•´ê²° ë°©ë²• - Algorithm 1

```c
do {
	while(turn != 0); // P1ì´ ê¸°ë‹¤ë¦¼
	critical section  // P0ì´ ì‹¤í–‰ë¨
	turn = 1          // P1ì´ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ë°”ê¾¸ì–´ì¤Œ
	remainder section
} while (1);
```

- mutual exclusionì„ ë§Œì¡±í•¨
- í•˜ì§€ë§Œ, ì•„ë¬´ë„ critical sectionì— ì—†ì„ ë•Œ ì­‰ critical sectionì´ ì‹¤í–‰ì´ ì•ˆ ë¨.
- ì¦‰, progressë¥¼ ë§Œì¡±í•˜ì§€ ì•ŠìŒ.

### í•´ê²° ë°©ë²• - Algoritm 2

```c
do {
	flag[i] = true;
	while (flag[j]);
	critical section
	flag[i] = false;
	remainder section
} while (1);
```

- mutual exclusionì€ ë§Œì¡±í•˜ì§€ë§Œ, progressë¥¼ ë§Œì¡±í•˜ì§€ ì•ŠìŒ.
- flagë¥¼ ì˜¬ë ¤ì£¼ì§€ ì•ŠëŠ” í•œ ì˜ì›íˆ critical section ì‹¤í–‰ ì•ˆ ë¨.

### í•´ê²° ë°©ë²• - Algorithm 3(Peterson's Algorithm)

```c
do {
	flag[i] = true;
	turn = j;
	while (flag[j] && turn == j);
	critical section
	flag[i] = false;
	remainder section
} while(1);
```

- ëª¨ë“  ì¶©ì¡± ì¡°ê±´ì„ ë§Œì¡±í•œë‹¤.
- í•˜ì§€ë§Œ Busy waiting(Spin lock) ë¬¸ì œì ì´ ìˆìŒ.
	- whileë¬¸ìœ¼ë¡œ ê³„ì† ëŒë©´ì„œ waití•¨. ì¦‰, ìì‹ ì˜ í• ë‹¹ ì‹œê°„ ë§Œí¼ CPUì™€ ë©”ëª¨ë¦¬ë¥¼ ê³„ì† ì‚¬ìš©í•˜ë©´ì„œ waití•˜ëŠ” ê²ƒ.
- ì†Œí”„íŠ¸ì›¨ì–´ì ìœ¼ë¡œ í•´ê²°í•˜ë ¤ê³  í•˜ë‹¤ ë³´ë‹ˆ ì´ë ‡ê²Œ í˜ë“  ê²ƒ..! í•˜ë“œì›¨ì–´ì ì¸ ë°©ì‹ì„ ê³ë“¤ì´ë©´ ëœë‹¤!

### Synchronization Hardware

```c
// synchronization variable
boolean lock = false;

// process
do {
	while(Test_and_Set(lock));
	critical section
	lock = false;
	remainder section
} while (1)
```

- í•˜ë“œì›¨ì–´ì ìœ¼ë¡œ Test and Setì„ atomicí•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì§€ì›.
	- ê°’ì„ ì½ëŠ” ì‘ì—…ê³¼, ê°’ì„ ì €ì¥í•˜ëŠ” ì‘ì—…ì„ ë™ì‹œì— í•˜ëŠ” ì‘ì—…ì„ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— ì˜í–¥ì„ ë°›ì§€ ì•Šê³  ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•¨.
- ì•ì˜ ì†Œí”„íŠ¸ì›¨ì–´ì ì¸ ë°©ì‹ìœ¼ë¡œ ë³µì¡í•˜ê²Œ í•´ê²°í•  í•„ìš”ê°€ ì—†ë‹¤.

## Semaphores

- ì•ì˜ ë°©ì‹ë“¤ì„ ì¶”ìƒí™”ì‹œí‚´
- Semaphore S
	- ë‘ ê°€ì§€ atomic ì—°ì‚°ì— ì˜í•´ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì¶”ìƒ ìë£Œí˜•
	- ì •ìˆ˜ ë³€ìˆ˜ë¼ê³  í•  ë•Œ,
		- ì–‘ìˆ˜ì´ë©´ ê°’ì„ í•˜ë‚˜ ê¹ê³  critical sectionì— ì§„ì…, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ waití•˜ëŠ” P í•¨ìˆ˜ì™€,
		- critical sectionì—ì„œ ë¹ ì ¸ë‚˜ì™€ Sì˜ ê°’ì„ ì¦ê°€ì‹œí‚¤ëŠ” V í•¨ìˆ˜
	- í•´ë‹¹ í•¨ìˆ˜ ë‘ ê°€ì§€ë¥¼ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì†Œí”„íŠ¸ì›¨ì–´ì ìœ¼ë¡œ ê°€ì ¸ë‹¤ ì“°ë©´ ë¨.
	- í”„ë¡œê·¸ë˜ë¨¸ëŠ” ì¶”ìƒ ìë£Œí˜•ìœ¼ë¡œ ì œê³µë˜ëŠ” Semaphoreì˜ êµ¬í˜„ë¶€ë¥¼ ìƒê°í•˜ì§€ ì•Šì•„ë„ ë¨. -> í›¨ì”¬ ê°„ë‹¨í•˜ê²Œ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒ.

```c
semaphore mutex; // initially 1

do {
	P(mutex);
	critical section
	V(mutex);
	remainder section
} while(1);
```

- í•´ë‹¹ ë°©ì‹ë„ Busy-wait(spin lock).
- í•˜ì§€ë§Œ Block & WakeUp(sleep lock)ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ë„ ìˆë‹¤.

### Block & WakeUp Implementation

```c
// Semaphoreë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜

typedef struct
{
	int value;
	struct process *L;
} semaphore;

semaphore S;

     S
 +-------+
 | value |
 |   L ------> PCB ----> PCB ----> PCB
 +-------+

```

- block
	- ì»¤ë„ì´ block í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ í”„ë¡œì„¸ìŠ¤ë¥¼ suspend ì‹œí‚´.
	- í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ì˜ PCBë¥¼ semaphoreì˜ wait queueì— ë„£ìŒ.
- wakeup(P)
	- blockëœ í”„ë¡œì„¸ìŠ¤ Pë¥¼ wakeup ì‹œí‚´.
	- í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ì˜ PCBë¥¼ ready queueì— ë„£ìŒ.


```c
P(S):

S.value--;
if(S.value < 0)
{
	// add process to S.L
	block();
}

V(S):

S.value++;
if (S.value <= 0)
{
	// remove process P from S.L
	wakeup(P);
}
```

- ì—¬ê¸°ì„œ S.valueëŠ” ìƒí™©ì„ ë‚˜íƒ€ë‚´ëŠ” ê²ƒ.

### Busy-wait VS Block & Wakeup

- Semaphoreë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì— ìˆì–´ì„œ Busy-waitì€ ê³„ì† CPU í• ë‹¹ ì‹œê°„ì„ íƒœìš°ë©´ì„œ ê¸°ë‹¤ë ¤ì•¼í•˜ì§€ë§Œ, Block & Wakeupì€ CPUë¥¼ ë°˜ë‚©í•˜ê³  blocked ìƒíƒœë¡œ ë“¤ì–´ê°€ì„œ ê¸°ë‹¤ë¦¬ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ í›„ìê°€ íš¨ìœ¨ì .
- í•˜ì§€ë§Œ, Block & Wakeupë„ ì˜¤ë²„í—¤ë“œê°€ ë“ ë‹¤.
	- critical sectionì˜ ê¸¸ì´ê°€ ì§§ìœ¼ë©´ Busy-waitë„ ê´œì°®ë‹¤.

### Types of Semaphore

#### Counting Semaphore
- ë„ë©”ì¸ì´ 0 ì´ìƒì¸ ì„ì˜ì˜ ì •ìˆ˜ê°’.
- ì£¼ë¡œ ìì›ì˜ ê°œìˆ˜ë¥¼ ì„¸ëŠ” ë° ì‚¬ìš©.

#### Binary Semaphore
- 0 ë˜ëŠ” 1
- ì£¼ë¡œ mutual exclusion(lock/unlock)ì— ì‚¬ìš©.

### Semaphore ì‚¬ìš©ì‹œì˜ ì£¼ì˜ì 

#### Deadlock
- ë‘˜ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ê°€ ì„œë¡œ ìƒëŒ€ë°©ì— ì˜í•´ ì¶©ì¡±ë  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ ë¬´í•œíˆ ê¸°ë‹¤ë¦¬ëŠ” í˜„ìƒ
- Semaphore S, Qê°€ ê° 1ë¡œ ì´ˆê¸°í™”ëœ ìƒíƒœì—ì„œ, í”„ë¡œì„¸ìŠ¤ 0ê³¼ 1ì´ ë‹¤ìŒê³¼ ê°™ì€ ìƒíƒœì¼ ë•Œ
```
process0     process1

  P(S);        P(Q);
  P(Q);        P(S);
  ...          ...
  V(S);        V(Q);
  V(Q);        V(S);
```
- í”„ë¡œì„¸ìŠ¤ 0ì´ P(S);ë¡œ Së¥¼ íšë“í•˜ê³  CPUë¥¼ ëºê²¼ì„ ë•Œ, í”„ë¡œì„¸ìŠ¤ 1ì´ P(Q);ë¡œ Që¥¼ íšë“í•˜ê³  ë‚˜ë©´
- ê° í”„ë¡œì„¸ìŠ¤ 0ê³¼ 1ì€ ì˜ì›íˆ Qì™€ Së¥¼ íšë“í•˜ì§€ ëª»í•œë‹¤. ì´ê²ƒì´ êµì°©ìƒíƒœ.
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, í”„ë¡œì„¸ìŠ¤ 0ê³¼ 1ì˜ ì½”ë“œë¥¼ P(S); P(Q);ë¡œ í†µì¼ì‹œí‚¤ë©´ ëœë‹¤.

#### Starvation
- indefinite blocking

## ì¶œì²˜

í•´ë‹¹ ë‚´ìš©ì€ KOCW ê°•ì˜ ì¤‘ [ì´í™”ì—¬ìëŒ€í•™êµì˜ ìš´ì˜ì²´ì œ-ë°˜íš¨ê²½ ê°•ì˜](http://www.kocw.net/home/search/kemView.do?kemId=1046323)ì˜ ë‚´ìš©ì„ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.