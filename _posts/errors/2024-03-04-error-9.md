---
title: "MySQL Error, Cannot add or update a child row: a foreign key constraint fails"
toc: true
toc_sticky: true
categories:
    - ğŸ“‚ all
    - MySQL
    - error
    - sapjil
tags:
    - MySQL
    - SQL
last_modified_at: 2024-03-04
---

## FK(ì™¸ë˜í‚¤) Constraint ì—ëŸ¬ 

APIë¥¼ ë§Œë“¤ë©´ì„œ DBì— ëª© ë°ì´í„°ë¥¼ ë„£ëŠ” ê³¼ì •ì—ì„œ ì—ëŸ¬ê°€ ë‚¬ë‹¤.

Foreign key constraint failsë¼ëŠ” êµ¬ì ˆì„ ë³´ê³  ì™¸ë˜í‚¤ ê´€ë ¨ ì—ëŸ¬ë¼ëŠ” ê²ƒì„ ì•Œì•„ì°¨ë ¸ë‹¤.

ê·¸ëŸ°ë° ë¶„ëª… ë°©ê¸ˆ ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ìš”ì†Œë“¤ì„ ë§Œë“¤ì—ˆë˜ ê²ƒ ê°™ì€ë° ì™œ ì™¸ë˜í‚¤ ì—ëŸ¬ê°€ ë‚˜ì§€..?

ë¼ëŠ” ì˜ë¬¸ì´ ë“  ì±„ë¡œ ê³„ì† ì‚½ì§ˆì„ í–ˆë‹¤.

### ...ë¡œê·¸ë¥¼ ìì„¸íˆ ë“¤ì—¬ë‹¤ë³´ì..

í—ˆíŠ¼ ì‹œê°„ë§Œ ë‚­ë¹„í•˜ë‹¤ê°€ ì—ëŸ¬ ë¡œê·¸ë¥¼ ì•„ì˜ˆ ë³µì‚¬í•´ë´¤ë‹¤.

```
Error Code: 1452. Cannot add or update a child row: a foreign key constraint fails (`project_db`.`message`, CONSTRAINT `message_ibfk_1` FOREIGN KEY (`id`) REFERENCES `project`.`box` (`box_id`) ON UPDATE CASCADE)
```

DBë¥¼ ì˜ëª» ì°¸ì¡°í•˜ê³  ìˆì—ˆë‹¤... ã… ã… ã… ã… ã… 

project_dbì— í•´ë‹¹í•˜ëŠ” í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì„ ì°¸ì¡°í•´ì•¼í•˜ëŠ”ë°, projectë¥¼ ì°¸ì¡°í•˜ê³  ìˆì–´ì„œ `ì—¥??? ì—†ëŠ”ë””????` ìš”ëŸ¬ê³  ìˆë˜ ê²ƒì„..

## í•´ê²°(?) SQLë¬¸

```sql
-- FK ì°¸ì¡°í•˜ëŠ” ì»¬ëŸ¼ì´ ë‹¤ë¥¸ DBì˜ í…Œì´ë¸”ì— ìˆëŠ” ìš”ì†Œì˜€ìŒ...ã… ã…  
alter table PROJECT_DB.message drop foreign key message_ibfk_1;
alter table PROJECT_DB.message add foreign key (box_id) references PROJECT_DB.box (id) on update cascade on delete restrict;

update PROJECT_DB.message set box_id = 1 where message_id = 2
```

ìœ„ì™€ ê°™ì´ FK Constraintë¥¼ ì¬ì„¤ì •í•´ì£¼ê³  FKë„ ìƒˆë¡œ ë¶€ì—¬í•´ì¤¬ë‹¤.